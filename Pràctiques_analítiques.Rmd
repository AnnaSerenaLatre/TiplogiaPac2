---
title: "Pràctiques_analítiques"
author: "ANNA SERENA LATRE/XAVIER JORDÀ MURRIA"
date: "19 maig de 2019"
output: 
  html_document:
    fig_height: 5
    fig_width: 7
    number_sections: yes
    theme: journal
    toc: yes
    toc_depth: 2
  pdf_document:
    toc: yes
  word_document: default
---


```{r}
library(readr)
Train_T <- read_csv("C:/Users/ANNA/Desktop/Tipologia i cicle de vida de les dades/TipologiaPAC2/output_data/Train_T.csv")

Test_T <- read_csv("C:/Users/ANNA/Desktop/Tipologia i cicle de vida de les dades/TipologiaPAC2/output_data/Test_T.csv")
```
Per defecte els datasets amb les pràctiques d'integració i neteja guarden una nova variable amb la indexació dels registres que suprimirem.

```{r}
names(Test_T)
```

```{r}
# Deleting x1 variable. 
Test_T <- subset(Test_T, select=c(2,3,4,5,6,7,8,9))
```
```{r}
names(Train_T)
```
```{r}
# Deleting x1 variable. 
Train_T <- subset(Train_T, select=c(2,3,4,5,6,7,8,9))
```

# ANOVA test:
## Contrast de diferències en la variable Sex i la variable Age.
```{r}
fit <- aov(Survived ~ Sex*Age, data=Train_T)
fit
# Two Way Factorial Design 
```
## Constrast de diferències entre la variable Sex i la variable Pclass. 
```{r}
fit <- aov(Survived ~ Sex*Pclass, data=Train_T) # same thing
fit
# Two Way Factorial Design 
```



# Regressió logística:
## Model de regressió logística.
```{r}
reg.model =glm(Survived ~., family = binomial(link = 'logit'), data = Train_T)
summary(reg.model)
```
```{r}
confint(reg.model)
```
```{r}
library(aod)
wald.test( b= coef(reg.model), Sigma = vcov(reg.model), Terms = 8:9)
```

```{r}
wald.test( b= coef(reg.model), Sigma = vcov(reg.model), Terms = 2:3)
```

```{r}
exp(cbind(OR = coef(reg.model), confint(reg.model)))
```



```{r}
anova(reg.model, Test="Chisq")
```
```{r}
library(pscl)
pR2(reg.model)
```



## Prova train&test per al model de regressió logística.
```{r}
titanic_predict = predict(reg.model, newdata = subset(Test_T, select = c(1:8), type='response'))
head(titanic_predict)
```


```{r}
titanic_predict = ifelse(titanic_predict > 0.5, 1,0)
head(titanic_predict)
```

```{r}
misClassificError = mean(titanic_predict != Test_T$Survived)
print(paste('Accuracy', 1 - misClassificError))
```


```{r}
library(ROCR)
p<- predict(reg.model, newdata = Test_T, type='response')
pr <- prediction(p, Test_T$Survived)
prf <- performance(pr, measure = "tpr", x.measure = "fpr")
plot(prf)


```
```{r}
auc <- performance(pr, measure="auc")
str(auc)
```

```{r}
auc= auc@y.values[[1]]
auc
```
# SVM Suported Vectorial Machine:
## Model SVM.
```{r}
library(kernlab)
svm.model <- ksvm(Survived ~ ., data = Train_T, kernel ='vanilladot')
```

```{r}
svm.model
```
## Prova train&test per a l'algorisme SVM. 

```{r}
svm.predict <- predict(svm.model, Test_T[,1:8])
head(svm.predict)
```
```{r}
svm.predict = ifelse(svm.predict > 0.5, 1, 0)
```

```{r}
table(svm.predict, Test_T$Survived)
```

```{r}
misClassifiError = mean(svm.predict != Test_T$Survived)
print(paste('Accuracy', 1 - misClassifiError))
```

```{r}
p = predict(svm.model, newdata = subset(Test_T, select=c(1:8)), type='response')
pr = prediction(p, Test_T$Survived)
prf = performance(pr, measure = 'tpr', x.measure ='fpr')
plot(prf)
abline(0,1, lwd =2, lty =2)
```
```{r}
auc = performance(pr, measure = 'auc')
str(auc)
```
```{r}
auc = auc@y.values[[1]]
```


# Referències

https://www.statmethods.net/stats/anova.html



