---
title: "Pràctiques_analítiques"
author: "ANNA SERENA LATRE/XAVIER JORDÀ MURRIA"
date: "19 maig de 2019"
output: 
  html_document:
    fig_height: 5
    fig_width: 7
    number_sections: yes
    theme: journal
    toc: yes
    toc_depth: 2
  pdf_document:
    toc: yes
  word_document: default
---


```{r}
library(readr)
Train_T <- read_csv("C:/Users/ANNA/Desktop/Tipologia i cicle de vida de les dades/TipologiaPAC2/output_data/Train_T.csv")

Test_T <- read_csv("C:/Users/ANNA/Desktop/Tipologia i cicle de vida de les dades/TipologiaPAC2/output_data/Test_T.csv")
```
Per defecte els datasets amb les pràctiques d'integració i neteja guarden una nova variable amb la indexació dels registres que suprimirem.

```{r}
names(Test_T)
```

```{r}
# Deleting x1 variable. 
Test_T <- subset(Test_T, select=c(2,3,4,5,6,7,8,9))
```
```{r}
names(Train_T)
```
```{r}
# Deleting x1 variable. 
Train_T <- subset(Train_T, select=c(2,3,4,5,6,7,8,9))
```

# Analítica descriptiva i inferencial:
```{r}
# Software packages required.
library(party)

```
## Arbre de classificació per a les variables Age i Fare.

```{r}
# Classifier Tree Model for Age and Fare variables.
model_2 <- ctree(Age~Fare, data = Train_T)
model_2
plot(model_2)
```

## Arbre de classificació per a la variable Age i Survived.
```{r}
# Classifier Tree Model for Survived and Age variables. 
model_3 <- ctree(Survived~Age, data = Train_T)
model_3
plot(model_3)
```
## Arbre de classificació per a la variable Fare i Survived.
```{r}
# Classifier Tree Model for Survived and Fare variables. 
model_4 <- ctree(Survived~Fare, data = Train_T)
model_4
plot(model_4)
```
## Arbre de classificació per a la variable Survived, Fare i Age.
```{r}
# Classifier Tree Model for Survived, Fare and Age variables. 
model_5 <- ctree(Survived~Fare~Age, data = Train_T)
model_5
```


```{r}
# Tree graphic display for the model_5
plot(model_5)
```


## Arbre de classificació per a la variable Survived, Age i Fare.
```{r}
# Classifier Tree Model for Survived, Age and Fare variables. 
model_6 <- ctree(Survived~Age~Fare, data = Train_T)
model_6
```

```{r}
# Tree graphic display for the model_6.
plot(model_6)
```


## ANOVA : test.

Contrast de diferències en les mostres de supervivents de les variables Sex, Pclass i Age.


```{r}
# ANOVA mean test, for statistical averages  main traits. 
fit <- aov(Survived ~ Sex*Pclass*Age, data=Train_T) # same thing
fit
# Two Way Factorial Design 
```


# Models de regressió, classificació i predicció:
## Model de regressió logística.
```{r}
# Logistic regression model.
reg.model =glm(Survived ~., family = binomial(link = 'logit'), data = Train_T)
summary(reg.model)
```
```{r}
confint(reg.model)
```
```{r}
# Wald test for independence among variables. 
library(aod)
wald.test( b= coef(reg.model), Sigma = vcov(reg.model), Terms = 7:8)
```

```{r}
wald.test( b= coef(reg.model), Sigma = vcov(reg.model), Terms = 2:3)
```

```{r}
exp(cbind(OR = coef(reg.model), confint(reg.model)))
```



```{r}
# ANOVA test for the regression model.
anova(reg.model, Test="Chisq")
```
```{r}
library(pscl)
pR2(reg.model)
```



## Prova train&test per al model de regressió logística.
```{r}
# Linear Regression model predicment.
titanic_predict = predict(reg.model, newdata = subset(Test_T, select = c(1:8), type='response'))
head(titanic_predict)
```


```{r}
titanic_predict = ifelse(titanic_predict > 0.5, 1,0)
head(titanic_predict)
```

```{r}
# Logistic regression model error.
misClassificError = mean(titanic_predict != Test_T$Survived)
# Logistic regression accuracy.
print(paste('Accuracy', 1 - misClassificError))
```


```{r}
# ROC curve for positivie and false TRUE.
library(ROCR)
p<- predict(reg.model, newdata = Test_T, type='response')
pr <- prediction(p, Test_T$Survived)
prf <- performance(pr, measure = "tpr", x.measure = "fpr")
plot(prf)


```
```{r}
# AUC performance.
auc <- performance(pr, measure="auc")
str(auc)
```

```{r}
# AUC value. 
auc= auc@y.values[[1]]
auc
```

## Model SVM Suported Vectorial Machine.
```{r}
# SVM model construction. 
library(kernlab)
svm.model <- ksvm(Survived ~ ., data = Train_T, kernel ='vanilladot')
```

```{r}
# SVM parameter model and results. 
svm.model
```
## Prova train&test per a l'algorisme SVM. 

```{r}
# SVM predictments.
svm.predict <- predict(svm.model, Test_T[,1:8])
head(svm.predict)
```
```{r}
svm.predict = ifelse(svm.predict > 0.5, 1, 0)
```

```{r}
# SVM true and false matrix. 
table(svm.predict, Test_T$Survived)
```

```{r}
# SVM error model.
misClassifiError = mean(svm.predict != Test_T$Survived)
# SVM accuracy model. 
print(paste('Accuracy', 1 - misClassifiError))
```

```{r}
# Plotting SVM true and false positives. 
p = predict(svm.model, newdata = subset(Test_T, select=c(1:8)), type='response')
pr = prediction(p, Test_T$Survived)
prf = performance(pr, measure = 'tpr', x.measure ='fpr')
plot(prf)
abline(0,1, lwd =2, lty =2)
```
```{r}
# SVM AUC performance. 
auc = performance(pr, measure = 'auc')
str(auc)
```
```{r}
# SVM value. 
auc = auc@y.values[[1]]
```


# Referències

https://www.statmethods.net/stats/anova.html



